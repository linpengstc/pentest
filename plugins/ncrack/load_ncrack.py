
import sqlite3
import os

# 未支持 
services = [ ('ftp', 21), ('ssh', 22),('mysql', 3306), 
    ('mssql',1433), ('redis', 6379), ('smb', 445)]

if not os.path.exists('out/ncrack'):
    os.mkdir('out/ncrack')

conn = sqlite3.connect("report/data.db")
cur = conn.cursor()
with open('out/ncrack/ncrack.target', 'w') as f:
    for service in services:
        try:
            cur.execute("select * from nmap where p{} != ''".format(service[1]))
            targets = cur.fetchall()
            # with open('out/hydra/{}.target'.format(service[0]), 'w') as f:
            for target in targets:
                print(service[0] + " " + target[0])
                f.write( service[0] + " " + target[0] + "\n")
        except Exception as e:
            print(e)
cur.close()
