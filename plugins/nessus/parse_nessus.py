import json
import pprint
import sqlite3

conn = sqlite3.connect("report/data.db")
cur = conn.cursor()
cur.execute('DROP TABLE IF EXISTS nessus')
cur.execute("create table nessus(ip varchar(20),name varchar(50), port varchar(10),protocol varchar(10),output varchar(1000),severity varchar(10))")


def save_into_sqlite3():
    with open("out/ness.report") as ff:
        results = json.loads(ff.read())
        pprint.pprint(results)
        for r in results:
            ip = r['ip']
            vuls = r['vuls']
            for vul in vuls:
                cur.execute("insert into nessus(ip, name, port, protocol,output,severity) values (?,?,?,?,?,?)",
                (ip, vul['name'], vul['port'], vul['protocol'], vul['output'], vul['severity']))
    values = cur.execute('select * from nessus').fetchall()
    pprint.pprint(values)

save_into_sqlite3()
conn.commit()
conn.close()