import sqlite3
from xlwt import *

class Sqlite2Xls(object):
    
    def __init__(self):
        self.conn = sqlite3.connect("report/data.db")
        self.cur = self.conn.cursor()
        self.tables = []

    def list_tables(self):
        self.cur.execute("SELECT name FROM sqlite_master WHERE type='table';")
        for t in self.cur.fetchall():
            self.tables.append(t[0])
        return self.tables

    def list_columns(self, tb_name):
        self.cur.execute("PRAGMA  table_info({})".format(tb_name))
        col_names = []
        for col in self.cur.fetchall():
            col_names.append(col[1])
        return col_names

    def list_datas(self, tb_name):
        self.cur.execute("select * from {}".format(tb_name))
        datas = []
        for data in self.cur.fetchall():
            datas.append(data)
        return datas

    def sqlite2xls(self): 

        pattern = Pattern()  # Create the Pattern
        pattern.pattern = Pattern.SOLID_PATTERN
        pattern.pattern_fore_colour = 22
        style = XFStyle()  # Create the Pattern
        style.pattern = pattern  # Add Pattern to Style
        dstyle = easyxf('align: wrap on')
        file = Workbook(encoding='utf-8')
        applications = self.list_tables()
        for application in applications:
            sheet = file.add_sheet(application)
            for i,col in enumerate(self.list_columns(application)):
                sheet.write(0, i, col, style)
            for i,data in enumerate(self.list_datas(application)):
                for j,d in enumerate(data):
                    sheet.write(i+1, j, d, dstyle)
        file.save("report/report.xls")


    def __del__(self):
        self.conn.close()

sqlite2xls = Sqlite2Xls()
sqlite2xls.sqlite2xls()
# print(sqlite2xls.list_datas("nmap"))
# print(sqlite2xls.list_tables())
# print(sqlite2xls.list_column("nmap"))