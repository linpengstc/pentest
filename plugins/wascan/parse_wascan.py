import pprint
import sqlite3

def parse_result():
    results = []
    with open("out/wascan/wascan.result") as f:
        r = {}
        for l in f:
            l = l.strip()
            if l.startswith("[+] URL:"):
                if r != {}:
                    results.append(r)
                r['url'] = l.replace("[+] URL:", "").strip()
                r['info'] = []
            else:
                
                r['info'].append(l)    
                # results.append(r)
        pprint.pprint(results)
    return results

def save(datas):
    conn = sqlite3.connect("report/data.db")
    cur = conn.cursor()
    cur.execute('DROP TABLE IF EXISTS webinfo')
    cur.execute("create table webinfo (url varchar(100), info varchar(10000))")
    for d in datas:
        cur.execute("insert into webinfo(url, info) values(?,?)", (d['url'], "\n".join(d['info'])))
    conn.commit()
    conn.close()


if __name__ == "__main__":
    results = parse_result()
    save(results)