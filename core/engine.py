from multiprocessing import Pool
import subprocess
import argparse
import shlex
import sys

class Engine(object):
    
    # 并发数量
    def __init__(self, cmds, pnum = 5):
        self.cmds = cmds
        self.pnum = pnum

    def task(self, cmd):
        p = subprocess.Popen(shlex.split(cmd),close_fds=True, bufsize=-1)
        p.communicate()

    def start(self):
        pool = Pool(self.pnum)
        for cmd in self.cmds:
            pool.apply_async(self.task, (cmd,))
        pool.close()
        pool.join()

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('-c',"--cmds", help='输入执行的命令')
    parser.add_argument('-p',"--process", type=int, help="进程数量", default=5)
    args = parser.parse_args()
    cmds = args.cmds.split("\n")
    pnum = args.process
    engine = Engine(cmds, pnum)
    engine.start()
    